<!doctype html>
<html>
<head>
    <title>Voice SDK Sample</title>
</head>
<body>
<div id="app"></div>

<button id="mute">Mute</button>
<button id="unmute">Un-Mute</button>
<button id="hold">Hold</button>
<button id="unhold">Un-Hold</button>
<script>
    (function (d, n) {
        let js, lk, head = d.getElementsByTagName('head')[0];
        if (!d.getElementById(`${n}-js`)) {
            js = d.createElement('script');
            js.id = `${n}-js`;
            js.src = './js/voice-sdk.umd.cjs';
            head.appendChild(js);
        }

        if (!d.getElementById(`${n}-css`)) {
            lk = d.createElement('link');
            lk.id = `${n}-css`;
            lk.rel = 'stylesheet';
            lk.href = './css/voice-sdk.css';
            head.appendChild(lk);
        }
    }(document, 'voice-sdk'));

    window.onload = function () {
        const muteBtn = document.getElementById('mute');
        const unmuteBtn = document.getElementById('unmute');
        const holdBtn = document.getElementById('hold');
        const unholdBtn = document.getElementById('unhold');

        window.VoiceSDK.init({
            el: 'app',
            appId: 'your-app-id',
            appName: 'mirae.metechvn.com',
            secretKey: 'your-secret-key',
            gateways: ['wss://proxy-dev.metechvn.com:7443'],
            delegate: {
                onConnect: () => {
                    console.log('Connected');
                },
                onDisconnect: () => {
                    console.log('Disconnected');
                },
                callCreated: (caller, callee, params) => {
                    console.log('Call created', caller, callee, params);
                },
                callConnected: () => {
                    console.log('Call connected');
                },
                callTerminated: () => {
                    console.log('Call disconnected');
                },
            },
        }, async i => {
            console.log(await i.login({
                extension: '100099',
                password: 'abc123',
            }))


            let status = '';
            const { id, hangup } = await i.makeCall('0868959888', {
                did: '0945404928',
                delegate: {
                    callCreated: (caller, callee, params) => {
                        console.log('Call created override', caller, callee, params);
                        status = 'created';
                    },
                    callConnected: () => {
                        console.log('Call connected override');
                        status = 'connected';

                        muteBtn.onclick = () => i.mute();
                        unmuteBtn.onclick = () => i.unmute();
                        holdBtn.onclick = () => i.hold();
                        unholdBtn.onclick = () => i.unhold();

                    },
                    callTerminated: () => {
                        console.log('Call disconnected override');
                        status = 'terminated';
                    },
                    rtc: {
                        muted: () => {
                            console.log('Muted');
                        },
                        unmuted: () => {
                            console.log('Unmuted');
                        },
                        hold: () => {
                            console.log('Hold');
                        },
                        unhold: () => {
                            console.log('Unhold');
                        }
                    }
                }
            });
            console.log(`Day la callId: `, id);

            setTimeout(async () => {
                const res = await i.transfer('100001');

                console.log(`Day la res: `, res);
            }, 10000)

            setTimeout(() => {
                if (status !== 'connected') {
                    hangup();
                } else {
                    i.hangup();
                }
            }, 20000);
        });
    }
</script>
</body>

</html>
